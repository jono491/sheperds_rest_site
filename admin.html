<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - Shepherds Rest</title>
</head>
<body>
  <h1>Admin Login</h1>
  <form id="loginForm">
    <input type="password" id="password" placeholder="Enter Admin Password">
    <button type="submit">Login</button>
  </form>

  <div id="editor" style="display:none;">
    <h2>Website Content Editor</h2>
    <label>About: <textarea id="about"></textarea></label><br>
    <label>Menu (JSON): <textarea id="menu"></textarea></label><br>
    <label>Events: <textarea id="events"></textarea></label><br>
    <label>Hours: <textarea id="hours"></textarea></label><br>
    <label>Contact: <textarea id="contact"></textarea></label><br>
    <label>Booking Link: <input type="text" id="booking"></label><br>
    <h3>Upload Images</h3>
    <input type="file" id="imageUpload"><button onclick="uploadImage()">Upload</button>
    <div id="gallery"></div><br>
    <button onclick="saveContent()">Save</button>
  </div>

  <script>
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      const res = await fetch('/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ password: document.getElementById('password').value })
      });
      const data = await res.json();
      if (data.success) {
        document.getElementById('loginForm').style.display = "none";
        document.getElementById('editor').style.display = "block";
        loadContent();
      } else {
        alert("Wrong password");
      }
    });

    async function loadContent() {
      const res = await fetch('content.json');
      if (!res.ok) return;
      const data = await res.json();
      document.getElementById('about').value = data.about || "";
      document.getElementById('menu').value = JSON.stringify(data.menu || [], null, 2);
      document.getElementById('events').value = data.events || "";
      document.getElementById('hours').value = data.hours || "";
      document.getElementById('contact').value = data.contact || "";
      document.getElementById('booking').value = data.booking || "";
      if (data.gallery) {
        document.getElementById('gallery').innerHTML = data.gallery.map(img => '<img src="'+img+'" width="100">').join("");
      }
    }

    async function saveContent() {
      const content = {
        about: document.getElementById('about').value,
        menu: JSON.parse(document.getElementById('menu').value || "[]"),
        events: document.getElementById('events').value,
        hours: document.getElementById('hours').value,
        contact: document.getElementById('contact').value,
        booking: document.getElementById('booking').value,
        gallery: Array.from(document.getElementById('gallery').getElementsByTagName('img')).map(i => i.src)
      };
      await fetch('/update-content', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(content)
      });
      alert("Content Saved!");
    }

    async function uploadImage() {
      const fileInput = document.getElementById('imageUpload');
      const formData = new FormData();
      formData.append('image', fileInput.files[0]);
      const res = await fetch('/upload-image', { method: 'POST', body: formData });
      const data = await res.json();
      const galleryDiv = document.getElementById('gallery');
      const img = document.createElement('img');
      img.src = data.path;
      img.width = 100;
      galleryDiv.appendChild(img);
    }
  </script>
</body>
</html>
